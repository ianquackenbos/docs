---
title: Authentication
description: "Authenticate with the Shardly API"
---

## Overview

Shardly uses **Bearer token authentication** for all API requests. Tokens are obtained through the Clerk authentication system.

## Getting a Token

### From the Dashboard

1. Log in to your Shardly dashboard
2. Navigate to **Settings → API Keys**
3. Click **Generate New Key**
4. Copy the token (shown only once)

### Programmatically

If using Clerk's SDK in your application:

```javascript
import { useAuth } from '@clerk/nextjs';

function MyComponent() {
  const { getToken } = useAuth();
  
  async function callApi() {
    const token = await getToken();
    
    const response = await fetch('https://api.shardly.io/api/v1/deployments', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    return response.json();
  }
}
```

### Using API Keys (Service Accounts)

For server-to-server integrations, create an API key:

1. Go to **Settings → API Keys**
2. Click **Create API Key**
3. Set permissions and expiration
4. Use the key in your requests

```bash
curl -X GET "https://api.shardly.io/api/v1/deployments" \
  -H "Authorization: Bearer sk_live_xxxxxxxxxxxxx"
```

## Request Format

Include the token in the `Authorization` header:

```bash
Authorization: Bearer YOUR_TOKEN_HERE
```

Example request:

```bash
curl -X GET "https://api.shardly.io/api/v1/deployments" \
  -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
```

## Token Types

| Type | Format | Use Case | Expiration |
|------|--------|----------|------------|
| User Token | JWT | Dashboard, user actions | 1 hour |
| API Key | `sk_live_...` | Server-to-server | Configurable |
| Webhook Secret | `whsec_...` | Webhook validation | Never |

## Permissions

API keys can be scoped to specific permissions:

| Permission | Description |
|------------|-------------|
| `read:connections` | List and view connections |
| `write:connections` | Create and modify connections |
| `read:costs` | View cost data |
| `read:recommendations` | View recommendations |
| `write:recommendations` | Apply/dismiss recommendations |
| `execute:recommendations` | Auto-apply recommendations |
| `read:copilot` | Use the AI copilot |
| `admin` | Full access |

Example: Creating a read-only key:

```json
{
  "name": "Monitoring Dashboard",
  "permissions": ["read:connections", "read:costs", "read:recommendations"],
  "expires_at": "2025-01-01T00:00:00Z"
}
```

## Error Responses

### 401 Unauthorized

Token is missing or invalid:

```json
{
  "detail": "Not authenticated",
  "status_code": 401
}
```

**Solutions:**
- Check the `Authorization` header format
- Verify the token hasn't expired
- Regenerate the token if needed

### 403 Forbidden

Token is valid but lacks permission:

```json
{
  "detail": "Insufficient permissions",
  "status_code": 403,
  "required_permission": "execute:recommendations"
}
```

**Solutions:**
- Create a new key with required permissions
- Contact your admin for elevated access

## Security Best Practices

### 1. Never Expose Tokens

- Don't commit tokens to version control
- Don't log tokens in application logs
- Don't include in client-side code

### 2. Use Environment Variables

```bash
# .env file (never commit!)
SHARDLY_API_KEY=sk_live_xxxxx
```

```python
import os
api_key = os.environ.get('SHARDLY_API_KEY')
```

### 3. Rotate Keys Regularly

- Set expiration dates on API keys
- Rotate keys every 90 days
- Revoke unused keys immediately

### 4. Use Least Privilege

Create keys with only the permissions needed:
- Monitoring scripts: `read:costs` only
- Automation: `read:recommendations`, `execute:recommendations`
- Admin tools: `admin`

### 5. Monitor Key Usage

Review API key activity in **Settings → API Keys → Usage**:
- Last used date
- Request count
- Error rate

## Clerk Integration

Shardly uses [Clerk](https://clerk.com) for authentication.

### Webhooks

Configure Clerk webhooks to sync user data:

```
Endpoint: https://api.shardly.io/api/v1/auth/webhook
Events: user.created, user.updated, user.deleted
```

### JWT Verification

Tokens are verified using Clerk's JWKS:

```python
from clerk_backend_api import Clerk

clerk = Clerk(api_key="your_clerk_secret_key")

# Verify token
session = clerk.sessions.verify_token(token)
user_id = session.user_id
```

## Testing Authentication

Verify your token works:

```bash
curl -X GET "https://api.shardly.io/api/v1/auth/me" \
  -H "Authorization: Bearer $TOKEN"
```

Response:

```json
{
  "user_id": "user_123",
  "email": "user@example.com",
  "organization_id": "org_456",
  "permissions": ["read:costs", "read:recommendations"]
}
```

